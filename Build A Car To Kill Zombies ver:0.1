-- Vex Hub - Build A Car to Kill Zombies
-- v0.2
-- Changelog
-- Checkpoints 4-6
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

-- All checkpoints including Start (for reference if needed)
local checkpoints = {
    {name = "Start", position = Vector3.new(-66, 412, -45)},
    {name = "Checkpoint 1", position = Vector3.new(-20, 417, -1225)},
    {name = "Checkpoint 2", position = Vector3.new(-1020, 418, -1220)},
    {name = "Checkpoint 3", position = Vector3.new(-2120, 416, -2148)},
    {name = "Checkpoint 4", position = Vector3.new(-540, 420, -3364)},
    {name = "Checkpoint 5", position = Vector3.new(-310, 420, -5790)},
    {name = "Checkpoint 6", position = Vector3.new(-310, 420, -7350)}
}

-- Only Checkpoints 1–6 for the teleport sections
local checkpointsOnly = {
    {name = "Checkpoint 1", position = Vector3.new(-20, 417, -1225)},
    {name = "Checkpoint 2", position = Vector3.new(-1020, 418, -1220)},
    {name = "Checkpoint 3", position = Vector3.new(-2120, 416, -2148)},
    {name = "Checkpoint 4", position = Vector3.new(-540, 420, -3364)},
    {name = "Checkpoint 5", position = Vector3.new(-310, 420, -5790)},
    {name = "Checkpoint 6", position = Vector3.new(-310, 420, -7350)}
}

-- GUI settings
local guiWidth = 400
local guiHeight = 380
local buttonHeight = 40
local fontSize = 16
local themeColor = Color3.fromRGB(128, 0, 128)

-- Remember last selected tab
local lastTab = "Home"

-- Anti Void state
local antiVoidEnabled = false
local antiVoidHeight = -50 -- default safe height

-- Teleport function (supports vehicles)
local function teleportTo(pos, loop)
    local char = player.Character or player.CharacterAdded:Wait()
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local seat = nil
    for _, s in pairs(char:GetDescendants()) do
        if s:IsA("Seat") or s:IsA("VehicleSeat") then
            if s.Occupant and s.Occupant.Parent == char then
                seat = s
                break
            end
        end
    end

    local target = seat and seat.Parent or char
    if loop then
        local startTime = tick()
        while tick() - startTime < 5 do
            if target.PrimaryPart then
                target:SetPrimaryPartCFrame(CFrame.new(pos))
            else
                if target:FindFirstChild("HumanoidRootPart") then
                    target.HumanoidRootPart.CFrame = CFrame.new(pos)
                end
            end
            task.wait(0.2)
        end
    else
        if target.PrimaryPart then
            target:SetPrimaryPartCFrame(CFrame.new(pos))
        else
            if target:FindFirstChild("HumanoidRootPart") then
                target.HumanoidRootPart.CFrame = CFrame.new(pos)
            end
        end
    end
end

-- Draggable function
local function makeDraggable(frame)
    local dragging = false
    local dragInput, dragStart, startPos

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X,
                                       startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end

-- Create the GUI
local function createGUI()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Parent = player:WaitForChild("PlayerGui")
    screenGui.Name = "VexHubGUI"

    -- Toggle button
    local toggleRect = Instance.new("TextButton")
    toggleRect.Size = UDim2.new(0, 120, 0, 30)
    toggleRect.Position = UDim2.new(0, 20, 0, 100)
    toggleRect.BackgroundColor3 = themeColor
    toggleRect.BorderSizePixel = 0
    toggleRect.Text = "Car Game"
    toggleRect.Font = Enum.Font.SourceSansBold
    toggleRect.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggleRect.TextSize = fontSize
    toggleRect.Parent = screenGui

    -- Main frame
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, guiWidth, 0, guiHeight)
    mainFrame.Position = UDim2.new(0.5, -guiWidth/2, 0.5, -guiHeight/2)
    mainFrame.BackgroundColor3 = themeColor:lerp(Color3.fromRGB(60, 0, 60), 0.3)
    mainFrame.BorderSizePixel = 0
    mainFrame.Visible = false
    mainFrame.Parent = screenGui

    -- Header
    local header = Instance.new("TextLabel")
    header.Size = UDim2.new(1, 0, 0, 30)
    header.Position = UDim2.new(0, 0, 0, 0)
    header.BackgroundColor3 = themeColor
    header.BorderSizePixel = 0
    header.Text = "Vex Hub - Car Game"
    header.Font = Enum.Font.SourceSansBold
    header.TextColor3 = Color3.fromRGB(255, 255, 255)
    header.TextSize = fontSize
    header.Parent = mainFrame

    -- Tabs
    local tabColumn = Instance.new("Frame")
    tabColumn.Size = UDim2.new(0, 100, 1, -30)
    tabColumn.Position = UDim2.new(0, 0, 0, 30)
    tabColumn.BackgroundColor3 = themeColor:lerp(Color3.fromRGB(50, 0, 50), 0.4)
    tabColumn.BorderSizePixel = 0
    tabColumn.Parent = mainFrame

    local contentFrame = Instance.new("Frame")
    contentFrame.Size = UDim2.new(1, -100, 1, -30)
    contentFrame.Position = UDim2.new(0, 100, 0, 30)
    contentFrame.BackgroundColor3 = themeColor:lerp(Color3.fromRGB(70, 0, 70), 0.5)
    contentFrame.BorderSizePixel = 0
    contentFrame.Parent = mainFrame

    -- Tab buttons
    local function createTabButton(name, yPos)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1, 0, 0, buttonHeight)
        btn.Position = UDim2.new(0, 0, 0, yPos)
        btn.BackgroundColor3 = themeColor:lerp(Color3.fromRGB(90, 0, 90), 0.4)
        btn.BorderSizePixel = 0
        btn.Text = name
        btn.Font = Enum.Font.SourceSansBold
        btn.TextColor3 = Color3.fromRGB(255, 255, 255)
        btn.TextSize = fontSize
        btn.Parent = tabColumn
        return btn
    end

    local homeTabBtn = createTabButton("Home", 0)
    local teleportsTabBtn = createTabButton("Teleports", buttonHeight)
    local miscTabBtn = createTabButton("Misc", buttonHeight * 2)

    -- Home content
    local homeContent = Instance.new("Frame")
    homeContent.Size = UDim2.new(1, 0, 1, 0)
    homeContent.BackgroundTransparency = 1
    homeContent.Parent = contentFrame

    local welcomeText = Instance.new("TextLabel")
    welcomeText.Size = UDim2.new(1, -20, 0, 50)
    welcomeText.Position = UDim2.new(0, 10, 0, 10)
    welcomeText.BackgroundTransparency = 1
    welcomeText.Text = "Welcome to Vex Hub!\nJoin our Discord here:"
    welcomeText.Font = Enum.Font.SourceSansBold
    welcomeText.TextColor3 = Color3.fromRGB(255, 255, 255)
    welcomeText.TextSize = fontSize
    welcomeText.TextWrapped = true
    welcomeText.TextXAlignment = Enum.TextXAlignment.Left
    welcomeText.Parent = homeContent

    local discordButton = Instance.new("TextButton")
    discordButton.Size = UDim2.new(0, 100, 0, buttonHeight)
    discordButton.Position = UDim2.new(0, 10, 0, 70)
    discordButton.BackgroundColor3 = themeColor:lerp(Color3.fromRGB(100, 0, 100), 0.5)
    discordButton.Text = "Discord"
    discordButton.Font = Enum.Font.SourceSansBold
    discordButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    discordButton.TextSize = fontSize
    discordButton.Parent = homeContent
    discordButton.MouseButton1Click:Connect(function()
        setclipboard("https://discord.gg/sV8dcYssc")
    end)

    -- Teleports content
    local teleportsContent = Instance.new("Frame")
    teleportsContent.Size = UDim2.new(1, 0, 1, 0)
    teleportsContent.BackgroundTransparency = 1
    teleportsContent.Visible = false
    teleportsContent.Parent = contentFrame

    -- Scrollable teleport section function
    local function createTeleportSection(title, yPos, cpList, loop)
        local sectionLabel = Instance.new("TextLabel")
        sectionLabel.Size = UDim2.new(1, -20, 0, 25)
        sectionLabel.Position = UDim2.new(0, 10, 0, yPos)
        sectionLabel.BackgroundTransparency = 1
        sectionLabel.Text = title
        sectionLabel.Font = Enum.Font.SourceSansBold
        sectionLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        sectionLabel.TextSize = fontSize
        sectionLabel.TextXAlignment = Enum.TextXAlignment.Left
        sectionLabel.Parent = teleportsContent

        local scrollFrame = Instance.new("ScrollingFrame")
        scrollFrame.Size = UDim2.new(1, -20, 0, buttonHeight + 10)
        scrollFrame.Position = UDim2.new(0, 10, 0, yPos + 30)
        scrollFrame.CanvasSize = UDim2.new(0, #cpList * 100, 0, buttonHeight)
        scrollFrame.ScrollBarThickness = 6
        scrollFrame.HorizontalScrollBarInset = Enum.ScrollBarInset.Always
        scrollFrame.BackgroundTransparency = 1
        scrollFrame.Parent = teleportsContent

        local xOffset = 0
        for i, cp in ipairs(cpList) do
            local btn = Instance.new("TextButton")
            btn.Size = UDim2.new(0, 90, 0, buttonHeight)
            btn.Position = UDim2.new(0, xOffset, 0, 0)
            btn.BackgroundColor3 = themeColor:lerp(Color3.fromRGB(100, 0, 100), 0.6)
            btn.Text = cp.name
            btn.Font = Enum.Font.SourceSansBold
            btn.TextColor3 = Color3.fromRGB(255, 255, 255)
            btn.TextSize = fontSize
            btn.Parent = scrollFrame

            btn.MouseButton1Click:Connect(function()
                teleportTo(cp.position, loop)
            end)

            xOffset = xOffset + 100
        end

        return yPos + buttonHeight + 50
    end

    -- Use only Checkpoints 1–6 for teleport sections
    local nextY = 10
    nextY = createTeleportSection("Checkpoint Loop TP", nextY, checkpointsOnly, true)
    nextY = createTeleportSection("Checkpoint TP", nextY, checkpointsOnly, false)

    -- Misc content
    local miscContent = Instance.new("Frame")
    miscContent.Size = UDim2.new(1, 0, 1, 0)
    miscContent.BackgroundTransparency = 1
    miscContent.Visible = false
    miscContent.Parent = contentFrame

    -- Anti Void toggle
    local antiVoidButton = Instance.new("TextButton")
    antiVoidButton.Size = UDim2.new(0, 150, 0, 30)
    antiVoidButton.Position = UDim2.new(0, 10, 0, 10)
    antiVoidButton.BackgroundColor3 = themeColor:lerp(Color3.fromRGB(100, 0, 100), 0.5)
    antiVoidButton.Font = Enum.Font.SourceSansBold
    antiVoidButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    antiVoidButton.TextSize = fontSize
    antiVoidButton.Text = "Anti Void [X]"
    antiVoidButton.Parent = miscContent

    -- Safe height input
    local safeHeightInput = Instance.new("TextBox")
    safeHeightInput.Size = UDim2.new(0, 80, 0, 30)
    safeHeightInput.Position = UDim2.new(0, 10, 0, 50)
    safeHeightInput.BackgroundColor3 = themeColor:lerp(Color3.fromRGB(90, 0, 90), 0.5)
    safeHeightInput.TextColor3 = Color3.fromRGB(255, 255, 255)
    safeHeightInput.Font = Enum.Font.SourceSans
    safeHeightInput.TextSize = fontSize
    safeHeightInput.Text = tostring(antiVoidHeight)
    safeHeightInput.ClearTextOnFocus = false
    safeHeightInput.Parent = miscContent

    safeHeightInput.FocusLost:Connect(function(enterPressed)
        local val = tonumber(safeHeightInput.Text)
        if val then
            antiVoidHeight = val
        else
            safeHeightInput.Text = tostring(antiVoidHeight)
        end
    end)

    antiVoidButton.MouseButton1Click:Connect(function()
        antiVoidEnabled = not antiVoidEnabled
        if antiVoidEnabled then
            antiVoidButton.Text = "Anti Void [✔]"
        else
            antiVoidButton.Text = "Anti Void [X]"
        end
    end)

    -- Tab switching
    homeTabBtn.MouseButton1Click:Connect(function()
        homeContent.Visible = true
        teleportsContent.Visible = false
        miscContent.Visible = false
        lastTab = "Home"
    end)
    teleportsTabBtn.MouseButton1Click:Connect(function()
        homeContent.Visible = false
        teleportsContent.Visible = true
        miscContent.Visible = false
        lastTab = "Teleports"
    end)
    miscTabBtn.MouseButton1Click:Connect(function()
        homeContent.Visible = false
        teleportsContent.Visible = false
        miscContent.Visible = true
        lastTab = "Misc"
    end)

    -- Restore last tab
    if lastTab == "Home" then
        homeContent.Visible = true
        teleportsContent.Visible = false
        miscContent.Visible = false
    elseif lastTab == "Teleports" then
        homeContent.Visible = false
        teleportsContent.Visible = true
        miscContent.Visible = false
    else
        homeContent.Visible = false
        teleportsContent.Visible = false
        miscContent.Visible = true
    end

    -- Toggle main GUI
    toggleRect.MouseButton1Click:Connect(function()
        mainFrame.Visible = not mainFrame.Visible
    end)

    -- Make GUI draggable
    makeDraggable(toggleRect)
    makeDraggable(mainFrame)

    -- Anti Void loop
    RunService.RenderStepped:Connect(function()
        if antiVoidEnabled then
            local char = player.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                local hrp = char.HumanoidRootPart
                if hrp.Position.Y < antiVoidHeight then
                    local seat = nil
                    for _, s in pairs(char:GetDescendants()) do
                        if s:IsA("Seat") or s:IsA("VehicleSeat") then
                            if s.Occupant and s.Occupant.Parent == char then
                                seat = s
                                break
                            end
                        end
                    end
                    local target = seat and seat.Parent or char
                    if target.PrimaryPart then
                        target:SetPrimaryPartCFrame(CFrame.new(Vector3.new(hrp.Position.X, antiVoidHeight + 5, hrp.Position.Z)))
                    elseif hrp then
                        hrp.CFrame = CFrame.new(Vector3.new(hrp.Position.X, antiVoidHeight + 5, hrp.Position.Z))
                    end
                end
            end
        end
    end)
end

-- Create GUI initially
createGUI()

-- Recreate GUI on respawn
player.CharacterAdded:Connect(function()
    local oldGUI = player.PlayerGui:FindFirstChild("VexHubGUI")
    if oldGUI then oldGUI:Destroy() end
    createGUI()
end)
